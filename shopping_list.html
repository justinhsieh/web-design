<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>購物車</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js"></script>
    <script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/localization/messages_zh_TW.js "></script>

    <!--CSS-->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/shoppingCart_new.css" /
  </head>
  <body>
    <!-- 導覽列 -->
    <header>
      <nav
        class="navbar navbar-expand-lg bg-light border-bottom border-1 border-black"
      >
        <div class="container-fluid">
          <a class="navbar-brand d-flex align-items-center" href="index.html">
            <img src="img/hacker.png" alt="logo" class="logo" />
            <span class="logo-context fs-3 fw-bold">3C用品店|購物車</span>
          </a>
          <div class="tool-right me-4">
            <a href="personal_id.html" alt="account">
              <img src="img/user.png" class="icon pe-2" />
            </a>
            <a href="shopping_list.html" alt="shopping-cart">
              <img src="img/shopping-cart.png" class="icon" />
            </a>
          </div>
        </div>
      </nav>
    </header>
    <div class="container py-5">
      <!-- 購物車標題 -->
      <nav class="nav nav-tabs mt-3">
        <a class="nav-link" id="items-nav">全部 (<span id="items-count">1</span>)</a>
        <a class="nav-link active" id="phone-nav">手機/平板 (<span id="phone-count">1</span>)</a>
        <a class="nav-link" id="camera-nav">相機/相機配件 (<span id="camera-count">0</span>)</a>
        <a class="nav-link" id="computer-nav">電腦/筆電 (<span id="computer-count">0</span>)</a>
      </nav>
      <!-- 購物車內容 -->
      <div id="phone" class="type">
        <div class="cart-item row align-items-center">
          <div class="col-auto">
            <input type="checkbox" class="item-checkbox" checked />
          </div>
          <div class="col-auto">
            <img
              src="img/小米_Xiaomi_15_Ultra.webp"
              alt="商品圖片"
              width="100"
            />
          </div>
          <div class="col">
            <div class="fw-bold">官方旗艦館【小米】Xiaomi 15 Ultra 5G</div>
            <div>編號：11911911</div>
            <div>顏色：經典黑銀</div>
          </div>
          <div class="col-auto fs-5">
            單價:
            <span class="fs-6 text-danger"><i>$</i></span>
            <span class="unit-price text-danger" data-price="37999"
              >37,999</span
            >
          </div>
          <div class="col-auto">
            <button class="btn btn-outline-secondary btn-sm decrease">-</button>
            <input
              type="text"
              value="1"
              class="text-center quantity"
              id="quantity"
              readonly
            />
            <button class="btn btn-outline-secondary btn-sm increase">+</button>
          </div>
          <div class="col-auto">
            <a href="#" class="remove-item">移除</a>
          </div>
        </div>
      </div>
      <div id="camera" class="type"></div>
      <div id="computer" class="type"></div>
      <!-- 全選 -->
      <div class="row mt-3 align-items-center">
        <div class="col-auto">
          <input type="checkbox" id="check-all" checked />
          <label for="check-all">全選</label>
        </div>
        <div class="col text-end">
          <span class="fs-5">商品總金額：</span>
          <span class="text-danger">
            <span class="fs-6">$</span>
            <span class="fs-5" id="total-price">37,999</span>
          </span>
          <button class="btn btn-primary" id="payment-button">結帳(1)</button>
        </div>
      </div>
      <div id="payment" style="display: none">
        <!-- 付款資訊 -->
        <div class="mt-4">
          <div class="payment-section text-center">付款資料</div>
          <form action="#" method="post" id="form-account">
            <div class="mb-3">
              <label for="name" class="form-label">姓名</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                placeholder="ex. 王小明"
                minlength="2"
                maxlength="5"
                required
              />
            </div>
            <div class="mb-3">
              <label for="address" class="form-label">地址</label>
              <input
                type="text"
                class="form-control"
                id="address"
                name="address"
                required
              />
            </div>
            <div class="mb-3">
              <label for="card" class="form-label">卡號</label>
              <input
                type="text"
                class="form-control"
                id="card"
                name="card"
                pattern="[0-9]{4}-[0-9]{4}-[0-9]{4}"
                placeholder="xxxx-xxxx-xxxx"
                required
              />
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">電話</label>
              <input
                type="telNo"
                class="form-control"
                id="phone"
                name="phone"
                pattern="09[0-9]{2}-[0-9]{6}"
                placeholder="09xx-xxxxxx"
                required
              />
            </div>
            <!-- 訂單金額 -->
            <div class="total-section text-center mt-3">
              <div class="row">
                <div class="col">信用卡</div>
                <div class="col">=</div>
                <div class="col">本次訂單金額</div>
              </div>
              <div class="row text-danger">
                <div class="col">$<span id="card-total">37,999</span></div>
                <div class="col">=</div>
                <div class="col">$<span id="order-total">37,999</span></div>
              </div>
            </div>

            <!-- 確認結帳按鈕 -->
            <div class="text-center mt-3">
              <input
                type="submit"
                class="btn btn-primary"
                id="confirm-checkout"
                value="確認結帳"
              />
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      $(document).ready(function ($) {
        $("#form-account").validate({
          submitHandler: function (form) {
            alert("訂單已提交！");
            form.submit();
          },
          rules: {},
          messages: {
            name: {
              required: "帳號為必填欄位",
              minlength: "最少需2個字",
              maxlength: "最多需5個字",
            },
            address: {
              required: "地址為必填欄位",
            },
            card: {
              required: "卡號為必填欄位",
              pattern: "錯誤格式",
            },
            phone: {
              required: "電話為必填欄位",
              pattern: "錯誤格式",
            },
          },
        });
      });
    </script>
    <script>
      $(document).ready(function () {
        function updateTotal() {
          let total = 0;
          $(".cart-item").each(function () {
            let checkbox = $(this).find(".item-checkbox");
            if (checkbox.prop("checked")) {
              let price = parseInt($(this).find(".unit-price").data("price"));
              let quantity = parseInt($(this).find("#quantity").val());
              total += price * quantity;
            }
          });
          $("#total-price, #card-total, #order-total").text(
            total.toLocaleString()
          );
        }

        $(".increase").click(function () {
          let quantityInput = $(this).siblings("#quantity");
          let quantity = parseInt(quantityInput.val()) + 1;
          quantityInput.val(quantity);
          updateTotal();
        });

        $(".decrease").click(function () {
          let quantityInput = $(this).siblings("#quantity");
          let quantity = parseInt(quantityInput.val());
          if (quantity > 1) {
            quantityInput.val(quantity - 1);
            updateTotal();
          }
        });

        $(".remove-item").click(function () {
          $(this).closest(".cart-item").remove();
          updateTotal();
        });

        $("#check-all").change(function () {
          $(".item-checkbox").prop("checked", $(this).prop("checked"));
          updateTotal();
        });

        $(".item-checkbox").change(function () {
          updateTotal();
        });

        $("#payment-button").on("click", function () {
          $("#payment").show();
        });

        $("#items-nav").on("click", function () {
          $(".nav-link").removeClass("active");
          $(this).addClass("active");
          $(".type").show();
        });

        $("#phone-nav").on("click", function () {
          $(".nav-link").removeClass("active");
          $(this).addClass("active");
          $(".type").hide();
          $("#phone").show();
        });

        $("#camera-nav").on("click", function () {
          $(".nav-link").removeClass("active");
          $(this).addClass("active");
          $(".type").hide();
          $("#camera").show();
        });

        $("#computer-nav").on("click", function () {
          $(".nav-link").removeClass("active");
          $(this).addClass("active");
          $(".type").hide();
          $("#computer").show();
        });
        updateTotal();
      });
    </script>
  </body>
</html>
